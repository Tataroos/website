{"ast":null,"code":"import { BehaviorSubject } from 'rxjs';\nimport { CartItem } from '../model/cart-item';\nimport * as i0 from \"@angular/core\";\nexport class CartService {\n  constructor() {\n    this.cartItems = [];\n    // Use BehaviorSubject to broadcast changes to any component that listens\n    this.totalPrice = new BehaviorSubject(0);\n    this.totalQuantity = new BehaviorSubject(0);\n  }\n  addToCart(product) {\n    console.log(`Adding to cart: ${product.name}`);\n    // Check if item is already in the cart\n    let alreadyInCart = false;\n    let existingCartItem = undefined;\n    if (this.cartItems.length > 0) {\n      // Find the item in the cart based on its ID\n      existingCartItem = this.cartItems.find(item => item.id === product.id);\n      alreadyInCart = existingCartItem !== undefined;\n    }\n    if (alreadyInCart) {\n      // Increment quantity\n      existingCartItem.quantity++;\n    } else {\n      // Add new item to cart\n      this.cartItems.push(new CartItem(product));\n    }\n    // Update totals and tell everyone about it\n    this.computeCartTotals();\n  }\n  computeCartTotals() {\n    let totalPriceValue = 0;\n    let totalQuantityValue = 0;\n    for (let currentItem of this.cartItems) {\n      totalPriceValue += currentItem.quantity * currentItem.unitPrice;\n      totalQuantityValue += currentItem.quantity;\n    }\n    // Publish the new values to all subscribers (like the shopping-cart component)\n    this.totalPrice.next(totalPriceValue);\n    this.totalQuantity.next(totalQuantityValue);\n  }\n  getItems() {\n    return this.cartItems;\n  }\n  removeItem(cartItem) {\n    // Find the index of the item to remove\n    const itemIndex = this.cartItems.findIndex(item => item.id === cartItem.id);\n    // If found, remove it\n    if (itemIndex > -1) {\n      this.cartItems.splice(itemIndex, 1);\n      this.computeCartTotals();\n    }\n  }\n  decrementQuantity(cartItem) {\n    cartItem.quantity--;\n    if (cartItem.quantity === 0) {\n      // If quantity is zero, remove the item from the cart\n      this.removeItem(cartItem);\n    } else {\n      // Otherwise, just update the totals\n      this.computeCartTotals();\n    }\n  }\n  // Helper method for the cart page to increment\n  incrementQuantity(cartItem) {\n    cartItem.quantity++;\n    this.computeCartTotals();\n  }\n  // We will need this for the checkout page\n  clearCart() {\n    this.cartItems = [];\n    this.computeCartTotals();\n  }\n  static {\n    this.ɵfac = function CartService_Factory(t) {\n      return new (t || CartService)();\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: CartService,\n      factory: CartService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"names":["BehaviorSubject","CartItem","CartService","constructor","cartItems","totalPrice","totalQuantity","addToCart","product","console","log","name","alreadyInCart","existingCartItem","undefined","length","find","item","id","quantity","push","computeCartTotals","totalPriceValue","totalQuantityValue","currentItem","unitPrice","next","getItems","removeItem","cartItem","itemIndex","findIndex","splice","decrementQuantity","incrementQuantity","clearCart","factory","ɵfac","providedIn"],"sources":["D:\\thing\\web proj\\coffeeEcomExercise\\product\\src\\app\\service\\cart.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { BehaviorSubject, Subject } from 'rxjs';\nimport { CartItem } from '../model/cart-item';\nimport { Product } from '../model/product';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class CartService {\n\n  cartItems: CartItem[] = [];\n  \n  // Use BehaviorSubject to broadcast changes to any component that listens\n  totalPrice: Subject<number> = new BehaviorSubject<number>(0);\n  totalQuantity: Subject<number> = new BehaviorSubject<number>(0);\n\n  constructor() { }\n\n  addToCart(product: Product) {\n    console.log(`Adding to cart: ${product.name}`);\n    \n    // Check if item is already in the cart\n    let alreadyInCart: boolean = false;\n    let existingCartItem: CartItem | undefined = undefined;\n\n    if (this.cartItems.length > 0) {\n      // Find the item in the cart based on its ID\n      existingCartItem = this.cartItems.find(item => item.id === product.id); \n      alreadyInCart = (existingCartItem !== undefined);\n    }\n\n    if (alreadyInCart) {\n      // Increment quantity\n      existingCartItem!.quantity++;\n    } else {\n      // Add new item to cart\n      this.cartItems.push(new CartItem(product));\n    }\n\n    // Update totals and tell everyone about it\n    this.computeCartTotals();\n  }\n\n  computeCartTotals() {\n    let totalPriceValue: number = 0;\n    let totalQuantityValue: number = 0;\n\n    for (let currentItem of this.cartItems) {\n      totalPriceValue += currentItem.quantity * currentItem.unitPrice;\n      totalQuantityValue += currentItem.quantity;\n    }\n\n    // Publish the new values to all subscribers (like the shopping-cart component)\n    this.totalPrice.next(totalPriceValue);\n    this.totalQuantity.next(totalQuantityValue);\n  }\n\n  getItems(): CartItem[] {\n    return this.cartItems;\n  }\n\n  removeItem(cartItem: CartItem) {\n    // Find the index of the item to remove\n    const itemIndex = this.cartItems.findIndex(item => item.id === cartItem.id);\n\n    // If found, remove it\n    if (itemIndex > -1) {\n      this.cartItems.splice(itemIndex, 1);\n      this.computeCartTotals();\n    }\n  }\n\n  decrementQuantity(cartItem: CartItem) {\n    cartItem.quantity--;\n\n    if (cartItem.quantity === 0) {\n      // If quantity is zero, remove the item from the cart\n      this.removeItem(cartItem);\n    } else {\n      // Otherwise, just update the totals\n      this.computeCartTotals();\n    }\n  }\n\n  // Helper method for the cart page to increment\n  incrementQuantity(cartItem: CartItem) {\n    cartItem.quantity++;\n    this.computeCartTotals();\n  }\n\n  // We will need this for the checkout page\n  clearCart() {\n    this.cartItems = [];\n    this.computeCartTotals();\n  }\n}\n\n"],"mappings":"AACA,SAASA,eAAe,QAAiB,MAAM;AAC/C,SAASC,QAAQ,QAAQ,oBAAoB;;AAM7C,OAAM,MAAOC,WAAW;EAQtBC,YAAA;IANA,KAAAC,SAAS,GAAe,EAAE;IAE1B;IACA,KAAAC,UAAU,GAAoB,IAAIL,eAAe,CAAS,CAAC,CAAC;IAC5D,KAAAM,aAAa,GAAoB,IAAIN,eAAe,CAAS,CAAC,CAAC;EAE/C;EAEhBO,SAASA,CAACC,OAAgB;IACxBC,OAAO,CAACC,GAAG,CAAC,mBAAmBF,OAAO,CAACG,IAAI,EAAE,CAAC;IAE9C;IACA,IAAIC,aAAa,GAAY,KAAK;IAClC,IAAIC,gBAAgB,GAAyBC,SAAS;IAEtD,IAAI,IAAI,CAACV,SAAS,CAACW,MAAM,GAAG,CAAC,EAAE;MAC7B;MACAF,gBAAgB,GAAG,IAAI,CAACT,SAAS,CAACY,IAAI,CAACC,IAAI,IAAIA,IAAI,CAACC,EAAE,KAAKV,OAAO,CAACU,EAAE,CAAC;MACtEN,aAAa,GAAIC,gBAAgB,KAAKC,SAAU;;IAGlD,IAAIF,aAAa,EAAE;MACjB;MACAC,gBAAiB,CAACM,QAAQ,EAAE;KAC7B,MAAM;MACL;MACA,IAAI,CAACf,SAAS,CAACgB,IAAI,CAAC,IAAInB,QAAQ,CAACO,OAAO,CAAC,CAAC;;IAG5C;IACA,IAAI,CAACa,iBAAiB,EAAE;EAC1B;EAEAA,iBAAiBA,CAAA;IACf,IAAIC,eAAe,GAAW,CAAC;IAC/B,IAAIC,kBAAkB,GAAW,CAAC;IAElC,KAAK,IAAIC,WAAW,IAAI,IAAI,CAACpB,SAAS,EAAE;MACtCkB,eAAe,IAAIE,WAAW,CAACL,QAAQ,GAAGK,WAAW,CAACC,SAAS;MAC/DF,kBAAkB,IAAIC,WAAW,CAACL,QAAQ;;IAG5C;IACA,IAAI,CAACd,UAAU,CAACqB,IAAI,CAACJ,eAAe,CAAC;IACrC,IAAI,CAAChB,aAAa,CAACoB,IAAI,CAACH,kBAAkB,CAAC;EAC7C;EAEAI,QAAQA,CAAA;IACN,OAAO,IAAI,CAACvB,SAAS;EACvB;EAEAwB,UAAUA,CAACC,QAAkB;IAC3B;IACA,MAAMC,SAAS,GAAG,IAAI,CAAC1B,SAAS,CAAC2B,SAAS,CAACd,IAAI,IAAIA,IAAI,CAACC,EAAE,KAAKW,QAAQ,CAACX,EAAE,CAAC;IAE3E;IACA,IAAIY,SAAS,GAAG,CAAC,CAAC,EAAE;MAClB,IAAI,CAAC1B,SAAS,CAAC4B,MAAM,CAACF,SAAS,EAAE,CAAC,CAAC;MACnC,IAAI,CAACT,iBAAiB,EAAE;;EAE5B;EAEAY,iBAAiBA,CAACJ,QAAkB;IAClCA,QAAQ,CAACV,QAAQ,EAAE;IAEnB,IAAIU,QAAQ,CAACV,QAAQ,KAAK,CAAC,EAAE;MAC3B;MACA,IAAI,CAACS,UAAU,CAACC,QAAQ,CAAC;KAC1B,MAAM;MACL;MACA,IAAI,CAACR,iBAAiB,EAAE;;EAE5B;EAEA;EACAa,iBAAiBA,CAACL,QAAkB;IAClCA,QAAQ,CAACV,QAAQ,EAAE;IACnB,IAAI,CAACE,iBAAiB,EAAE;EAC1B;EAEA;EACAc,SAASA,CAAA;IACP,IAAI,CAAC/B,SAAS,GAAG,EAAE;IACnB,IAAI,CAACiB,iBAAiB,EAAE;EAC1B;;;uBAtFWnB,WAAW;IAAA;EAAA;;;aAAXA,WAAW;MAAAkC,OAAA,EAAXlC,WAAW,CAAAmC,IAAA;MAAAC,UAAA,EAFV;IAAM;EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}