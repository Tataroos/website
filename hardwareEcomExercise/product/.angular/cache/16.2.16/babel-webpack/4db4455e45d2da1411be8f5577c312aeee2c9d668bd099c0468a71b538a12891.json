{"ast":null,"code":"import { BehaviorSubject } from 'rxjs';\nimport { CartItem } from '../model/cart-item';\nimport * as i0 from \"@angular/core\";\nexport class CartService {\n  constructor() {\n    // --- Reactive State ---\n    // We use BehaviorSubject to hold the current list of items\n    // and make it available as an observable to any component.\n    this.cartItemsSubject = new BehaviorSubject([]);\n    this.items$ = this.cartItemsSubject.asObservable(); // The '$' indicates an observable\n    // We use BehaviorSubject for totals as well\n    this.totalPrice$ = new BehaviorSubject(0);\n    this.totalQuantity$ = new BehaviorSubject(0);\n    // Load cart from local storage on startup, if it exists\n    const storedItems = localStorage.getItem('cartItems');\n    if (storedItems) {\n      const items = JSON.parse(storedItems);\n      this.cartItemsSubject.next(items);\n      this.computeCartTotals(items);\n    }\n  }\n  /**\n   * Main logic to add a product to the cart.\n   * If the item already exists, it increments the quantity.\n   */\n  addToCart(product) {\n    const currentItems = this.cartItemsSubject.getValue();\n    let alreadyExists = false;\n    // Check if item already in cart\n    for (let item of currentItems) {\n      if (item.id === product.id) {\n        item.quantity++;\n        alreadyExists = true;\n        break;\n      }\n    }\n    // If not, create a new CartItem and add it to the array\n    if (!alreadyExists) {\n      currentItems.push(new CartItem(product));\n    }\n    // Notify all subscribers (like the cart page) of the changes\n    this.notifySubscribers(currentItems);\n  }\n  /**\n   * Decrements the quantity of an item.\n   */\n  decrementQuantity(cartItem) {\n    const currentItems = this.cartItemsSubject.getValue();\n    for (let item of currentItems) {\n      if (item.id === cartItem.id && item.quantity > 1) {\n        item.quantity--;\n        this.notifySubscribers(currentItems);\n        return; // Exit loop\n      }\n    }\n  }\n  /**\n   * Removes an item from the cart entirely.\n   */\n  removeFromCart(cartItem) {\n    let currentItems = this.cartItemsSubject.getValue();\n    currentItems = currentItems.filter(item => item.id !== cartItem.id);\n    this.notifySubscribers(currentItems);\n  }\n  /**\n   * Gets the current raw array of items (for checkout).\n   */\n  getCartItems() {\n    return this.cartItemsSubject.getValue();\n  }\n  /**\n   * Empties the cart after a successful order.\n   */\n  clearCart() {\n    this.notifySubscribers([]);\n  }\n  /**\n   * Helper function to update all observables and local storage.\n   */\n  notifySubscribers(items) {\n    // 1. Calculate new totals\n    const {\n      total,\n      quantity\n    } = this.computeCartTotals(items);\n    // 2. Notify all subscribers\n    this.cartItemsSubject.next(items);\n    this.totalPrice$.next(total);\n    this.totalQuantity$.next(quantity);\n    // 3. Persist to local storage\n    localStorage.setItem('cartItems', JSON.stringify(items));\n  }\n  /**\n   * Calculates the total price and quantity.\n   * @returns An object with total price and total quantity.\n   */\n  computeCartTotals(items) {\n    let total = 0;\n    let quantity = 0;\n    for (let item of items) {\n      total += item.quantity * item.unitPrice;\n      quantity += item.quantity;\n    }\n    return {\n      total,\n      quantity\n    };\n  }\n  static {\n    this.ɵfac = function CartService_Factory(t) {\n      return new (t || CartService)();\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: CartService,\n      factory: CartService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"names":["BehaviorSubject","CartItem","CartService","constructor","cartItemsSubject","items$","asObservable","totalPrice$","totalQuantity$","storedItems","localStorage","getItem","items","JSON","parse","next","computeCartTotals","addToCart","product","currentItems","getValue","alreadyExists","item","id","quantity","push","notifySubscribers","decrementQuantity","cartItem","removeFromCart","filter","getCartItems","clearCart","total","setItem","stringify","unitPrice","factory","ɵfac","providedIn"],"sources":["D:\\thing\\web proj\\coffeeEcomExercise\\product\\src\\app\\service\\cart.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { BehaviorSubject, Subject } from 'rxjs';\nimport { CartItem } from '../model/cart-item';\nimport { Product } from '../model/product';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class CartService {\n\n  // --- Reactive State ---\n  // We use BehaviorSubject to hold the current list of items\n  // and make it available as an observable to any component.\n  private cartItemsSubject = new BehaviorSubject<CartItem[]>([]);\n  public items$ = this.cartItemsSubject.asObservable(); // The '$' indicates an observable\n\n  // We use BehaviorSubject for totals as well\n  public totalPrice$ = new BehaviorSubject<number>(0);\n  public totalQuantity$ = new BehaviorSubject<number>(0);\n\n  constructor() {\n    // Load cart from local storage on startup, if it exists\n    const storedItems = localStorage.getItem('cartItems');\n    if (storedItems) {\n      const items: CartItem[] = JSON.parse(storedItems);\n      this.cartItemsSubject.next(items);\n      this.computeCartTotals(items);\n    }\n  }\n\n  /**\n   * Main logic to add a product to the cart.\n   * If the item already exists, it increments the quantity.\n   */\n  addToCart(product: Product) {\n    const currentItems = this.cartItemsSubject.getValue();\n    let alreadyExists = false;\n    \n    // Check if item already in cart\n    for (let item of currentItems) {\n      if (item.id === product.id) {\n        item.quantity++;\n        alreadyExists = true;\n        break;\n      }\n    }\n\n    // If not, create a new CartItem and add it to the array\n    if (!alreadyExists) {\n      currentItems.push(new CartItem(product));\n    }\n\n    // Notify all subscribers (like the cart page) of the changes\n    this.notifySubscribers(currentItems);\n  }\n\n  /**\n   * Decrements the quantity of an item.\n   */\n  decrementQuantity(cartItem: CartItem) {\n    const currentItems = this.cartItemsSubject.getValue();\n    for (let item of currentItems) {\n      if (item.id === cartItem.id && item.quantity > 1) {\n        item.quantity--;\n        this.notifySubscribers(currentItems);\n        return; // Exit loop\n      }\n    }\n  }\n\n  /**\n   * Removes an item from the cart entirely.\n   */\n  removeFromCart(cartItem: CartItem) {\n    let currentItems = this.cartItemsSubject.getValue();\n    currentItems = currentItems.filter(item => item.id !== cartItem.id);\n    this.notifySubscribers(currentItems);\n  }\n\n  /**\n   * Gets the current raw array of items (for checkout).\n   */\n  getCartItems(): CartItem[] {\n    return this.cartItemsSubject.getValue();\n  }\n\n  /**\n   * Empties the cart after a successful order.\n   */\n  clearCart() {\n    this.notifySubscribers([]);\n  }\n\n  /**\n   * Helper function to update all observables and local storage.\n   */\n  private notifySubscribers(items: CartItem[]) {\n    // 1. Calculate new totals\n    const { total, quantity } = this.computeCartTotals(items);\n\n    // 2. Notify all subscribers\n    this.cartItemsSubject.next(items);\n    this.totalPrice$.next(total);\n    this.totalQuantity$.next(quantity);\n    \n    // 3. Persist to local storage\n    localStorage.setItem('cartItems', JSON.stringify(items));\n  }\n\n  /**\n   * Calculates the total price and quantity.\n   * @returns An object with total price and total quantity.\n   */\n  private computeCartTotals(items: CartItem[]): { total: number, quantity: number } {\n    let total = 0;\n    let quantity = 0;\n\n    for (let item of items) {\n      total += item.quantity * item.unitPrice;\n      quantity += item.quantity;\n    }\n    return { total, quantity };\n  }\n}\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}